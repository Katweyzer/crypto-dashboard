<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Crypto Dashboard Binance</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #controls { margin-bottom: 15px; }
    select { padding: 5px; font-size: 14px; margin-right: 15px; }
    #chartContainer { width: 100%; max-width: 1200px; margin: auto; }
  </style>
</head>
<body>

<h1>Crypto Price History (Binance)</h1>

<div id="controls">
  <label>Токен: </label>
  <select id="tokenSelect">
    <option value="BTCUSDT">BTC</option>
    <option value="ATOMUSDT">ATOM</option>
    <option value="UNIONUSDT">UNION</option>
    <option value="TIAUSDT">TIA</option>
    <option value="ETHUSDT">ETH</option>
  </select>
</div>

<div id="chartContainer">
  <canvas id="cryptoChart"></canvas>
</div>

<script>
// CORS-прокси нужен только если открываешь напрямую в браузере
const corsProxy = "https://cors-anywhere.herokuapp.com/";

// Загрузка свечей Binance (публичный endpoint)
async function loadBinanceData(symbol) {
  const url = `${corsProxy}https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&limit=1500`;
  const res = await fetch(url);
  const data = await res.json();
  // преобразуем в {t, o, h, l, c, v}
  return data.map(k => ({
    t: new Date(k[0]),
    o: parseFloat(k[1]),
    h: parseFloat(k[2]),
    l: parseFloat(k[3]),
    c: parseFloat(k[4]),
    v: parseFloat(k[5])
  }));
}

// Обновление графика
async function updateChart() {
  const symbol = document.getElementById("tokenSelect").value;
  const candles = await loadBinanceData(symbol);

  const labels = candles.map(c => c.t.toISOString().split('T')[0]);
  const prices = candles.map(c => c.c);

  cryptoChart.data.labels = labels;
  cryptoChart.data.datasets[0].data = prices;
  cryptoChart.update();
}

// Создание графика
const ctx = document.getElementById("cryptoChart").getContext("2d");
const cryptoChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: "Цена закрытия (USD)",
      data: [],
      borderColor: 'orange',
      fill: false,
      tension: 0.1
    }]
  },
  options: {
    responsive: true,
    interaction: { mode: 'index', intersect: false },
    scales: {
      y: { title: { display: true, text: 'Цена (USD)' } },
      x: { title: { display: true, text: 'Дата' } }
    }
  }
});

// Смена токена
document.getElementById("tokenSelect").addEventListener("change", updateChart);

// Первый запуск
updateChart();
</script>
</body>
</html>
